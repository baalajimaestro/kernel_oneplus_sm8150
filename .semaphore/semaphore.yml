
version: v1.0
name: Build Kernel

agent:
  machine:
    type: e1-standard-2

  containers:
    - name: main
      image: 'fedora:latest'

blocks:
  - name: "Fetch and Prepare"
    task:
      jobs:
      - name: Fetch and Prepare
        commands:
          - checkout
          - dnf -y update && dnf -y install gcc-aarch64-linux-gnu \
                                            git-core \
                                            libtool \
                                            binutils \
                                            shtool \
                                            which \
                                            hostname \
                                            ccache \
                                            bc \
                                            gnupg \
                                            zip \
                                            curl \
                                            make \
                                            m4 \
                                            diffutils
          - git clone https://github.com/arter97/arm64-gcc.git -b master --depth=1 gcc
          - git clone https://github.com/arter97/arm32-gcc.git -b master --depth=1 gcc32
          - git clone https://github.com/baalajimaestro/AnyKernel3.git --depth=1 anykernel3
          - export CROSS_COMPILE="$(PWD)/gcc/bin/aarch64-elf-"
          - export CROSS_COMPILE_ARM32="$(PWD)/gcc32/bin/arm-eabi-"
          - export ARCH=arm64
          - export SUBARCH=arm64

      - name: Build
        commands:
          - make -j$(nproc) sm8150_defconfig O=out
          - make -j$(nproc) O=out